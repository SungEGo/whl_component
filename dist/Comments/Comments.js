"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ReplyComments=exports.UserComment=exports["default"]=exports.Comments=void 0;var _react=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_reactCssModules=_interopRequireDefault(require("react-css-modules")),_Comments=_interopRequireDefault(require("../style/Comments.styl")),_Avatar=_interopRequireDefault(require("../Avatar/Avatar")),_AddComment=require("../AddComment/AddComment"),_TimeConvert=_interopRequireDefault(require("../TimeConvert/TimeConvert")),_htmlReactParser=_interopRequireWildcard(require("html-react-parser")),_reactRouterDom=require("react-router-dom"),_ThumbUpDown=_interopRequireDefault(require("../ThumbUpDown/ThumbUpDown"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;return _getRequireWildcardCache=function(){return a},a}function _interopRequireWildcard(a){if(a&&a.__esModule)return a;if(null===a||"object"!==_typeof(a)&&"function"!=typeof a)return{default:a};var b=_getRequireWildcardCache();if(b&&b.has(a))return b.get(a);var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;f&&(f.get||f.set)?Object.defineProperty(c,e,f):c[e]=a[e]}return c["default"]=a,b&&b.set(a,c),c}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var Comments=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),_defineProperty(_assertThisInitialized(d),"openChild",function(a){d.setState({childcid:a})}),_defineProperty(_assertThisInitialized(d),"addComment",function(a,b,c){var e=d.props.addComment;e(b,c),d.openChild(a)}),_defineProperty(_assertThisInitialized(d),"getNewComment",function(a){var b=d.props.addComment;b(-1,a)}),d.state={childcid:null},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"render",value:function render(){var a=this,b=this.props,c=b.commentlist,d=b.userinfo,e=b.editComment,f=b.delComment,g=b.getRelComment,h=b.setCommentLike,i=b.otherMsg,j=b.userpath,k=b.commentFocus,l=b.commentBlur,n=this.state.childcid;return _react["default"].createElement("div",{className:"whl_comments"},!!d.mid&&_react["default"].createElement("div",{className:"summitcommentmargin"},_react["default"].createElement(_AddComment.AddComment,{userinfo:d,getComment:this.getNewComment,onFocus:k,onBlur:l})),c.map(function(b){return _react["default"].createElement("div",{className:"parentcomment",key:b.cid},_react["default"].createElement(UserComment,{comment:b,userinfo:d,addComment:a.addComment,editComment:e,delComment:f,pcid:-1,setCommentLike:h,otherMsg:i,userpath:j,commentFocus:k,commentBlur:l}),_react["default"].createElement(ReplyComments,{recommentct:b.recomment,child:b.child,isopen:n==b.cid,getRelComment:g,vid:b.vid,userinfo:d,addComment:a.addComment,editComment:e,delComment:f,pcid:b.cid,setCommentLike:h,otherMsg:i,userpath:j,commentFocus:k,commentBlur:l}))}))}}]),b}(_react.Component);exports.Comments=Comments,_defineProperty(Comments,"propTypes",{commentlist:_propTypes["default"].array,userinfo:_propTypes["default"].object,addComment:_propTypes["default"].func,editComment:_propTypes["default"].func,getRelComment:_propTypes["default"].func,delComment:_propTypes["default"].func,setCommentLike:_propTypes["default"].func,otherMsg:_propTypes["default"].func,userpath:_propTypes["default"].string,commentFocus:_propTypes["default"].func,commentBlur:_propTypes["default"].func}),_defineProperty(Comments,"defaultProps",{commentlist:[],userinfo:{mid:1,name:"WHL",src:""},addComment:function addComment(a,b){console.log({pcid:a,comment:b})},editComment:function editComment(a,b,c){console.log({cid:a,pcid:b,comment:c})},getRelComment:function getRelComment(a,b){console.log({vid:a,cid:b})},delComment:function delComment(a,b){console.log({cid:a,pcid:b})},setCommentLike:function setCommentLike(a,b,c){console.log({cid:a,pcid:b,tf:c})},otherMsg:function otherMsg(a){console.log(a)},userpath:"/u/${mid}",commentFocus:function commentFocus(){},commentBlur:function commentBlur(){}});var _default=(0,_reactCssModules["default"])(Comments,_Comments["default"]);exports["default"]=_default;var UserComment=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),_defineProperty(_assertThisInitialized(d),"moreOpen",function(a){d.setState({moreopen:a})}),_defineProperty(_assertThisInitialized(d),"openMoreInfo",function(a){a.nativeEvent.stopImmediatePropagation(),d.setState({moreinfo:!d.state.moreinfo})}),_defineProperty(_assertThisInitialized(d),"ousideClick",function(){d.setState({moreinfo:!1})}),_defineProperty(_assertThisInitialized(d),"leaveMoreInfo",function(a){a.nativeEvent.stopImmediatePropagation()}),_defineProperty(_assertThisInitialized(d),"openReply",function(){var a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0],b=d.props,c=b.comment,e=b.pcid,f=b.userpath,g=c.mid,h=c.username,i="",j="";j=null==f.match(/\$\{mid\}/g)?f+g:f.replace(/\$\{mid\}/,g),-1!=e&&(i=_react["default"].createElement(_react.Fragment,null,_react["default"].createElement(_reactRouterDom.Link,{to:j,className:"tag_name",contentEditable:"false",suppressContentEditableWarning:!0},"\xA0@",h,"\xA0"),"\xA0")),d.setState({replymode:a,defaultcomment:i})}),_defineProperty(_assertThisInitialized(d),"getReply",function(a){var b=d.props,c=b.addComment,e=b.pcid,f=b.comment,g=f.cid;d.openReply();var h=-1==e?g:e;console.log(h,a),c(g,h,a)}),_defineProperty(_assertThisInitialized(d),"getEdit",function(a){var b=d.props,c=b.editComment,e=b.pcid,f=b.comment,g=f.cid;d.openEdit(),c(g,e,a)}),_defineProperty(_assertThisInitialized(d),"openEdit",function(){var a=!!(0<arguments.length&&void 0!==arguments[0])&&arguments[0];d.ousideClick(),d.setState({editmode:a})}),d.state={editmode:!1,replymode:!1,moreinfo:!1,moreopen:!1,defaultcomment:""},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"componentDidMount",value:function componentDidMount(){document.addEventListener("click",this.ousideClick)}},{key:"componentWillUnmount",value:function componentWillUnmount(){document.removeEventListener("click",this.ousideClick)}},{key:"render",value:function render(){var a=this,b=this.props,c=b.comment,d=b.userinfo,e=b.delComment,f=b.setCommentLike,g=b.pcid,h=b.otherMsg,i=b.userpath,j=b.commentFocus,k=b.commentBlur,l=c.username,m=c.usersrc,n=c.des,o=c.since,p=c.mid,q=c.like,r=c.unlike,s=c.userlike,t=c.cid,u=this.state,v=u.editmode,w=u.replymode,x=u.moreopen,y=u.moreinfo,z=u.defaultcomment,A={replace:function replace(a){var b=a.attribs,c=a.children;return b?"tag_name"===b["class"]?_react["default"].createElement(_reactRouterDom.Link,{to:b.href,className:b["class"]},(0,_htmlReactParser.domToReact)(c,A)):void 0:void 0}};return _react["default"].createElement("div",{className:"whl_usercomment",onMouseOver:function onMouseOver(){return a.moreOpen(!0)},onMouseLeave:function onMouseLeave(){return a.moreOpen(!1)}},_react["default"].createElement("div",{className:"comment_more"},(x||y)&&d.mid==p&&_react["default"].createElement("div",{className:"moreabsolute"},_react["default"].createElement("span",{className:"material-icons-outlined",onClick:function onClick(b){return a.openMoreInfo(b)}},"more_vert")),!!y&&_react["default"].createElement("ul",{className:"comment_moreinfo",onClick:function onClick(b){return a.leaveMoreInfo(b)}},_react["default"].createElement("li",{onClick:function onClick(){return a.openEdit(!0)}},_react["default"].createElement("span",null,"\u7DE8\u8F2F")),_react["default"].createElement("li",{onClick:function onClick(){return e(t,g)}},_react["default"].createElement("span",null,"\u522A\u9664")))),_react["default"].createElement(_Avatar["default"],{alt:l,src:m,link:null==i.match(/\$\{mid\}/g)?i+p:i.replace(/\$\{mid\}/,p)}),_react["default"].createElement("div",null,v?_react["default"].createElement(_AddComment.AddComment,{userinfo:d,getComment:this.getEdit,defaultcomment:n,clickCancel:this.openEdit,mode:"edit",showavatar:!1,onFocus:j,onBlur:k}):_react["default"].createElement("div",null,_react["default"].createElement("div",{className:"name_time"},_react["default"].createElement("span",{className:"username"},_react["default"].createElement("b",null,l)),_react["default"].createElement("span",{className:"username"},_react["default"].createElement(_TimeConvert["default"],{time:o,updatetime:10}))),_react["default"].createElement("div",{className:"cdes"},(0,_htmlReactParser["default"])(n||"",A)),_react["default"].createElement("div",{className:"comment_like_unlike"},_react["default"].createElement(_ThumbUpDown["default"],{likect:q,unlikect:r,userlike:s,clickLike:function clickLike(){return d.mid?f(t,g,!0):h({err:"like",msg:"\u6309\u4E86\u559C\u6B61\uFF0C\u5C1A\u672A\u767B\u5165"})},clickUnLike:function clickUnLike(){return d.mid?f(t,g,!1):h({err:"unlike",msg:"\u6309\u4E86\u4E0D\u559C\u6B61\uFF0C\u5C1A\u672A\u767B\u5165"})}}),_react["default"].createElement("div",{className:"pointer",onClick:function onClick(){d.mid?a.openReply(!0):h({err:"reply",msg:"\u6309\u4E86\u56DE\u8986\uFF0C\u5C1A\u672A\u767B\u5165"})}},_react["default"].createElement("span",null,"\u56DE\u8986")))),w&&_react["default"].createElement("div",{className:"summitcomment"},_react["default"].createElement(_AddComment.AddComment,{userinfo:d,getComment:this.getReply,defaultcomment:z,clickCancel:this.openReply,mode:"edit",showavatar:!0,onFocus:j,onBlur:k}))))}}]),b}(_react.Component);exports.UserComment=UserComment;var ReplyComments=function(a){function b(a){var d;return _classCallCheck(this,b),d=c.call(this,a),_defineProperty(_assertThisInitialized(d),"componentDidUpdate",function(a){var b=d.props,c=b.isopen,e=b.cid;c!=a.isopen&&!0!=d.state.openchild&&d.setState({openchild:c})}),_defineProperty(_assertThisInitialized(d),"openChild",function(){d.setState({openchild:!d.state.openchild})}),d.state={openchild:!1},d}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"render",value:function render(){var a=this,b=this.props,c=b.recommentct,d=b.child,e=b.userinfo,f=b.addComment,g=b.editComment,h=b.delComment,i=b.getRelComment,j=b.setCommentLike,k=b.pcid,l=b.vid,n=b.otherMsg,o=b.userpath,p=b.commentFocus,q=b.commentBlur,r=this.state.openchild;return _react["default"].createElement("div",{className:"whl_replycomments"},0<c&&_react["default"].createElement("div",null,_react["default"].createElement("span",{className:"pointer reply_comment",onClick:function onClick(){return!r&&i(l,k),a.openChild()}},_react["default"].createElement("span",{className:"material-icons-outlined"},"arrow_drop_down"),_react["default"].createElement("span",null,"\u2002",r?"\u96B1\u85CF":"\u67E5\u770B".concat(1==c?"":" ".concat(c," \u5247")),"\u56DE\u8986"))),r&&d&&_react["default"].createElement("div",null,d.map(function(a){return _react["default"].createElement(UserComment,{key:a.cid,comment:a,userinfo:e,addComment:f,editComment:g,delComment:h,pcid:k,setCommentLike:j,otherMsg:n,userpath:o,commentFocus:p,commentBlur:q})})))}}]),b}(_react.Component);exports.ReplyComments=ReplyComments;